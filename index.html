<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Controle de Gastos — Excel Model</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="title">
    <h1>Controle de Gastos (modelo Excel)</h1>
    <p class="muted">Mês por índice; investimentos/guardado unificados; gráficos detalhados no Dashboard.</p>
  </header>

  <!-- month incrementer (numérico) -->
  <div class="month-incrementer">
    <button id="prev-month" class="small-btn">&lt;</button>
    <div class="month-display">
      <div>Índice do mês</div>
      <div id="month-index" class="month-index">0</div>
      <div id="month-label" class="month-label"></div>
    </div>
    <button id="next-month" class="small-btn">&gt;</button>
  </div>

  <nav class="tabs">
    <button data-tab="dashboard" class="tab-btn active">Dashboard</button>
    <button data-tab="input" class="tab-btn">Input</button>
    <button data-tab="invest" class="tab-btn">Investimentos</button>
    <button data-tab="log" class="tab-btn">Log</button>
  </nav>

  <main class="wrap">
    <!-- DASHBOARD -->
    <section id="tab-dashboard" class="tab-panel active panel">
      <div class="panel-top">
        <table class="accounts-table">
          <thead>
            <tr>
              <th>Conta</th><th>Saldo</th><th>Gasto Crédito (mês)</th><th>Gasto VR (mês)</th><th>Guardado</th>
            </tr>
          </thead>
          <tbody id="accounts-body"></tbody>
        </table>
      </div>

      <div class="panel-middle">
        <div class="left-box">
          <h3>Gasto Crédito — por conta (mês)</h3>
          <canvas id="gasto-credito-chart" width="420" height="240"></canvas>

          <h3 style="margin-top:18px">Gasto por categoria (mês)</h3>
          <canvas id="category-pie-chart" width="420" height="240"></canvas>
        </div>

        <div class="right-box">
          <h3>Visão geral (mês)</h3>
          <div class="yellow-grid">
            <div class="y-row"><span>Crédito</span><strong id="avail-credit">R$ 0,00</strong></div>
            <div class="y-row"><span>VR</span><strong id="avail-vr">R$ 0,00</strong></div>
            <div class="y-row"><span>Saldo</span><strong id="avail-saldo">R$ 0,00</strong></div>
            <div class="y-row"><span>Guardado</span><strong id="avail-guardado">R$ 0,00</strong></div>
          </div>

          <div class="small-box">
            <strong>Crédito + Débito</strong>
            <div id="credit-debit-small">R$ 0,00</div>
          </div>

          <h3 style="margin-top:18px">Tendência (6 meses)</h3>
          <canvas id="monthly-line-chart" width="300" height="200"></canvas>
        </div>
      </div>
    </section>

    <!-- INPUT -->
    <section id="tab-input" class="tab-panel inputs">
      <h2>Novo gasto / entrada</h2>

      <!-- Totais do mês (separado, visualmente) -->
      <div class="monthly-config">
        <h4>Configurações do mês (editar só no início do mês)</h4>
        <div class="month-totals">
          <div class="tot-block">
            <label>Crédito (total do mês)</label>
            <input id="input-credit-total" type="number" step="0.01" />
          </div>
          <div class="tot-block">
            <label>VR (total do mês)</label>
            <input id="input-vr-total" type="number" step="0.01" />
          </div>
          <div class="tot-block">
            <label>Entrada (renda do mês)</label>
            <input id="input-entrada-total" type="number" step="0.01" />
          </div>
        </div>
      </div>

      <form id="expense-form" class="form-grid">
        <div class="form-field">
          <label>Data (hoje por padrão)</label>
          <input type="date" id="exp-date" />
        </div>
        <div class="form-field">
          <label>Descrição (opcional)</label>
          <input type="text" id="exp-desc" placeholder="Ex: Mercado, Uber..." />
        </div>
        <div class="form-field">
          <label>Valor (R$)</label>
          <input type="number" step="0.01" id="exp-amount" required/>
        </div>
        <div class="form-field">
          <label>Tipo (ação)</label>
          <select id="exp-type">
            <option value="saldo">Debitar Saldo</option>
            <option value="credito">Debitar Crédito</option>
            <option value="vr">Debitar VR</option>
            <option value="entrada">Entrada (depositar)</option>
          </select>
        </div>
        <div class="form-field">
          <label>Banco / Conta</label>
          <select id="exp-account"></select>
        </div>
        <div class="form-field">
          <label>Categoria</label>
          <select id="exp-category">
            <option value="alimentacao">Alimentação</option>
            <option value="gasolina">Gasolina</option>
            <option value="mercado">Mercado</option>
            <option value="transporte">Transporte</option>
            <option value="lazer">Lazer</option>
            <option value="saude">Saúde</option>
            <option value="assinaturas">Assinaturas</option>
            <option value="investimento">Investimento</option>
            <option value="outros">Outros</option>
          </select>
        </div>
        <div class="form-field">
          <label>Forma (opcional)</label>
          <input type="text" id="exp-method" placeholder="Ex: Cartão, Dinheiro"/>
        </div>

        <div class="form-actions">
          <button class="btn-primary" type="submit">Registrar</button>
        </div>
      </form>

      <hr style="margin:16px 0; border:0; border-top:1px solid rgba(255,255,255,0.04)"/>

      <h3>Linhas longas (editar manual — alimentam o dashboard)</h3>
      <div id="editable-accounts" class="editable-accounts"></div>

      <div class="actions">
        <button id="save-btn" class="btn">Salvar</button>
        <button id="reset-btn" class="btn danger">Resetar valores Excel</button>
      </div>
    </section>

    <!-- INVESTIMENTOS (guardado unificado) -->
    <section id="tab-invest" class="tab-panel panel">
      <h2>Guardado (Investimentos)</h2>

      <div class="invest-actions">
        <form id="invest-form" class="invest-form">
          <div class="form-row">
            <label>Conta</label>
            <select id="invest-account"></select>
          </div>
          <div class="form-row">
            <label>Valor (R$)</label>
            <input id="invest-amount" type="number" step="0.01" />
          </div>
          <div class="form-row">
            <label>Ação</label>
            <select id="invest-action">
              <option value="investir">Investir (guardar)</option>
              <option value="guardar">Guardar (guardar)</option>
            </select>
          </div>
          <div class="form-row">
            <label>Descrição (opcional)</label>
            <input id="invest-desc" type="text" />
          </div>
          <div class="form-row">
            <button id="invest-submit" class="btn-primary" type="button">Executar</button>
          </div>
        </form>
      </div>

      <h3>Resumo de Guardado</h3>
      <div class="invest-grid">
        <div class="invest-list" id="invest-list"></div>
        <div class="invest-summary yellow-grid">
          <div class="y-row"><span>Guardado Total</span><strong id="guardado-total">R$ 0,00</strong></div>
        </div>
      </div>

      <h3 style="margin-top:18px">Log de Guardado (Investimentos)</h3>
      <div class="table-wrapper">
        <table>
          <thead><tr><th>Data</th><th>Conta</th><th>Ação</th><th>Valor</th><th>Descrição</th></tr></thead>
          <tbody id="invest-log-body"></tbody>
        </table>
      </div>
    </section>

    <!-- LOG -->
    <section id="tab-log" class="tab-panel inputs">
      <h2>Log de gastos</h2>
      <div class="log-controls">
        <label>Filtrar conta</label>
        <select id="log-account-filter">
          <option value="all">Todas</option>
        </select>

        <label>Mostrar apenas mês ativo</label>
        <input id="log-show-only-month" type="checkbox" checked />
        <label class="muted small">(se desmarcar, mostra todo o histórico)</label>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr><th>Data</th><th>Descrição</th><th>Conta</th><th>Tipo</th><th>Categoria</th><th>Valor</th><th>Forma</th><th></th></tr>
          </thead>
          <tbody id="log-body"></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="foot">
    <small>Salvo no navegador (localStorage). Rode localmente com Flask (ver README / app.py) para testar antes de publicar.</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js"></script>
</body>
</html>
